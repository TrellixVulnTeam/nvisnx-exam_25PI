import { Component, ChangeDetectorRef, ViewChild, HostListener, HostBinding, } from "@angular/core";
import { trigger, transition, query, style, stagger, animate, keyframes, } from "@angular/animations";
import { ColorFormats } from "../../enums/formats";
import { ConverterService } from "../../services/converter.service";
import { defaultColors } from "../../helpers/default-colors";
import { formats } from "../../helpers/formats";
import { Hsva } from "../../clases/formats";
import { NgxColor } from "../../clases/color";
export class PanelComponent {
    constructor(service, cdr) {
        this.service = service;
        this.cdr = cdr;
        this.color = "#000000";
        this.previewColor = "#000000";
        this.hsva = new Hsva(0, 1, 1, 1);
        this.colorsAnimationEffect = "slide-in";
        this.palette = defaultColors;
        this.variants = [];
        this.colorFormats = formats;
        this.format = ColorFormats.HEX;
        this.canChangeFormat = true;
        this.menu = 1;
        this.hideColorPicker = false;
        this.hideTextInput = false;
        this.colorPickerControls = "default";
    }
    click(event) {
        if (this.isOutside(event)) {
            this.emitClose("cancel");
        }
    }
    onScroll() {
        this.onScreenMovement();
    }
    onResize() {
        this.onScreenMovement();
    }
    ngOnInit() {
        this.setPosition();
        this.hsva = this.service.stringToHsva(this.color);
        this.indexSeleccionado = this.findIndexSelectedColor(this.palette);
    }
    ngAfterViewInit() {
        this.setPositionY();
    }
    onScreenMovement() {
        this.setPosition();
        this.setPositionY();
        if (!this.panelRef.nativeElement.style.transition) {
            this.panelRef.nativeElement.style.transition = "transform 0.5s ease-out";
        }
    }
    findIndexSelectedColor(colors) {
        let resultIndex = undefined;
        if (this.color) {
            for (let i = 0; i < colors.length; i++) {
                const color = colors[i];
                if (typeof color == "string") {
                    if (this.service.stringToFormat(this.color, ColorFormats.HEX) ==
                        this.service.stringToFormat(color, ColorFormats.HEX)) {
                        resultIndex = i;
                    }
                }
                else {
                    if (this.findIndexSelectedColor(color.variants) != undefined) {
                        resultIndex = i;
                    }
                }
            }
        }
        return resultIndex;
    }
    iniciate(triggerInstance, triggerElementRef, color, palette, animation, format, hideTextInput, hideColorPicker, acceptLabel, cancelLabel, colorPickerControls, position) {
        this.colorPickerControls = colorPickerControls;
        this.triggerInstance = triggerInstance;
        this.TriggerBBox = triggerElementRef;
        this.color = color;
        this.hideColorPicker = hideColorPicker;
        this.hideTextInput = hideTextInput;
        this.acceptLabel = acceptLabel;
        this.cancelLabel = cancelLabel;
        if (format) {
            if (formats.includes(format)) {
                this.format = formats.indexOf(format.toLowerCase());
                this.canChangeFormat = false;
                if (this.service.getFormatByString(this.color) != format.toLowerCase()) {
                    this.setColor(this.service.stringToHsva(this.color));
                }
            }
            else {
                console.error("Format provided is invalid, using HEX");
                this.format = ColorFormats.HEX;
            }
        }
        else {
            this.format = formats.indexOf(this.service.getFormatByString(this.color));
        }
        this.previewColor = this.color;
        this.palette = palette !== null && palette !== void 0 ? palette : defaultColors;
        this.colorsAnimationEffect = animation;
        if (position == "top") {
            let TriggerBBox = this.TriggerBBox.nativeElement.getBoundingClientRect();
            this.positionString =
                "transform: translateY(calc( -100% - " + TriggerBBox.height + "px ))";
        }
    }
    setPosition() {
        if (this.TriggerBBox) {
            var viewportOffset = this.TriggerBBox.nativeElement.getBoundingClientRect();
            this.top = viewportOffset.top + viewportOffset.height;
            this.left =
                viewportOffset.left + 250 > window.innerWidth
                    ? viewportOffset.right - 250
                    : viewportOffset.left;
        }
    }
    setPositionY() {
        var triggerBBox = this.TriggerBBox.nativeElement.getBoundingClientRect();
        var panelBBox = this.panelRef.nativeElement.getBoundingClientRect();
        var panelHeight = panelBBox.height;
        //Check for space above the trigger
        if (0 > panelBBox.top - 5) {
            this.positionString = "";
        }
        //Check for space below the trigger
        if (panelHeight > window.innerHeight - (panelBBox.top - 5)) {
            //there is no space, move panel over the trigger
            this.positionString =
                "transform: translateY(calc( -100% - " + triggerBBox.height + "px ));";
        }
        this.cdr.detectChanges();
    }
    hasVariant(color) {
        if (!this.previewColor) {
            return false;
        }
        return (typeof color != "string" &&
            color.variants.some((v) => v.toUpperCase() == this.previewColor.toUpperCase()));
    }
    isSelected(color) {
        if (!this.previewColor) {
            return false;
        }
        return (typeof color == "string" &&
            color.toUpperCase() == this.previewColor.toUpperCase());
    }
    getBackgroundColor(color) {
        if (typeof color == "string") {
            return { background: color };
        }
        else {
            return { background: color === null || color === void 0 ? void 0 : color.preview };
        }
    }
    onAlphaChange(event) {
        this.palette = this.ChangeAlphaOnPalette(event, this.palette);
    }
    ChangeAlphaOnPalette(alpha, colors) {
        var result = [];
        for (let i = 0; i < colors.length; i++) {
            const color = colors[i];
            if (typeof color == "string") {
                let newColor = this.service.stringToHsva(color);
                newColor.onAlphaChange(alpha);
                result.push(this.service.toFormat(newColor, this.format));
            }
            else {
                let newColor = new NgxColor();
                let newColorPreview = this.service.stringToHsva(color.preview);
                newColorPreview.onAlphaChange(alpha);
                newColor.preview = this.service.toFormat(newColorPreview, this.format);
                newColor.variants = this.ChangeAlphaOnPalette(alpha, color.variants);
                result.push(newColor);
            }
        }
        return result;
    }
    /**
     * Change color from default colors
     * @param string color
     */
    changeColor(color) {
        this.setColor(this.service.stringToHsva(color));
        // this.triggerInstance.onChange();
        this.emitClose("accept");
    }
    onChangeColorPicker(event) {
        this.temporalColor = event;
        this.color = this.service.toFormat(event, this.format);
        // this.setColor(event);
        this.triggerInstance.sliderChange(this.service.toFormat(event, this.format));
    }
    changeColorManual(color) {
        this.previewColor = color;
        this.color = color;
        this.hsva = this.service.stringToHsva(color);
        this.triggerInstance.setColor(this.color);
        // this.triggerInstance.onChange();
    }
    setColor(value) {
        this.hsva = value;
        this.color = this.service.toFormat(value, this.format);
        this.setPreviewColor(value);
        this.triggerInstance.setColor(this.color);
    }
    setPreviewColor(value) {
        this.previewColor = this.service.hsvaToRgba(value).toString();
    }
    onChange() {
        // this.triggerInstance.onChange();
    }
    onColorClick(color) {
        if (typeof color == "string") {
            this.changeColor(color);
        }
        else {
            this.variants = color.variants;
            this.menu = 2;
        }
    }
    addColor() {
        this.menu = 3;
        this.backupColor = this.color;
        this.color = "#FF0000";
        this.temporalColor = this.service.stringToHsva(this.color);
    }
    nextFormat() {
        if (this.canChangeFormat) {
            this.format = (this.format + 1) % this.colorFormats.length;
            this.setColor(this.hsva);
        }
    }
    emitClose(status) {
        if (this.menu == 3) {
            if (status == "cancel") {
            }
            else if (status == "accept") {
                this.setColor(this.temporalColor);
            }
        }
        this.triggerInstance.close();
    }
    onClickBack() {
        if (this.menu == 3) {
            this.color = this.backupColor;
            this.hsva = this.service.stringToHsva(this.color);
        }
        this.indexSeleccionado = this.findIndexSelectedColor(this.palette);
        this.menu = 1;
    }
    isOutside(event) {
        return event.target.classList.contains("ngx-colors-overlay");
    }
}
PanelComponent.decorators = [
    { type: Component, args: [{
                selector: "ngx-colors-panel",
                template: "<div class=\"opened\" [style]=\"positionString\" #dialog>\n  <ng-container *ngIf=\"menu == 1\">\n    <div class=\"colors\" [@colorsAnimation]=\"colorsAnimationEffect\">\n      <ng-container *ngFor=\"let color of palette; let i = index\">\n        <div class=\"circle wrapper color\">\n          <div\n            (click)=\"onColorClick(color)\"\n            class=\"circle color circle-border\"\n            [ngStyle]=\"getBackgroundColor(color)\"\n          >\n            <div *ngIf=\"i == this.indexSeleccionado\" class=\"selected\"></div>\n          </div>\n        </div>\n      </ng-container>\n      <div\n        style=\"background: rgb(245 245 245); position: relative\"\n        (click)=\"addColor()\"\n        *ngIf=\"!hideColorPicker && this.colorPickerControls != 'only-alpha'\"\n        class=\"circle button\"\n      >\n        <div\n          *ngIf=\"!this.indexSeleccionado\"\n          style=\"\n            position: absolute;\n            height: 7px;\n            width: 7px;\n            border: 1px solid rgba(0, 0, 0, 0.03);\n            border-radius: 100%;\n            top: 0;\n            right: 0;\n          \"\n          [ngStyle]=\"getBackgroundColor(color)\"\n        ></div>\n        <svg\n          xmlns=\"http://www.w3.org/2000/svg\"\n          height=\"24px\"\n          viewBox=\"0 0 24 24\"\n          width=\"24px\"\n          fill=\"#222222\"\n        >\n          <path d=\"M24 24H0V0h24v24z\" fill=\"none\" opacity=\".87\" />\n          <path d=\"M16.59 8.59L12 13.17 7.41 8.59 6 10l6 6 6-6-1.41-1.41z\" />\n        </svg>\n        <!-- <div class=\"add\">\n          <icons icon=\"add\"></icons>\n        </div> -->\n      </div>\n      <color-picker\n        *ngIf=\"!hideColorPicker && this.colorPickerControls == 'only-alpha'\"\n        [controls]=\"colorPickerControls\"\n        [color]=\"hsva\"\n        (colorChange)=\"onChangeColorPicker($event)\"\n        (onAlphaChange)=\"onAlphaChange($event)\"\n      ></color-picker>\n    </div>\n  </ng-container>\n  <ng-container *ngIf=\"menu == 2\">\n    <div class=\"colors\" [@colorsAnimation]=\"colorsAnimationEffect\">\n      <div class=\"circle wrapper\">\n        <div (click)=\"onClickBack()\" class=\"add\">\n          <svg\n            xmlns=\"http://www.w3.org/2000/svg\"\n            width=\"24\"\n            height=\"24\"\n            viewBox=\"0 0 24 24\"\n          >\n            <path d=\"M0 0h24v24H0z\" fill=\"none\" />\n            <path\n              d=\"M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z\"\n            />\n          </svg>\n        </div>\n      </div>\n\n      <ng-container *ngFor=\"let variant of variants\">\n        <div class=\"circle wrapper color\">\n          <div\n            (click)=\"changeColor(variant)\"\n            class=\"circle circle-border\"\n            [ngStyle]=\"{ background: variant }\"\n          >\n            <div *ngIf=\"isSelected(variant)\" class=\"selected\"></div>\n          </div>\n        </div>\n      </ng-container>\n    </div>\n  </ng-container>\n  <ng-container *ngIf=\"menu == 3\">\n    <div class=\"nav-wrapper\">\n      <div\n        (click)=\"onClickBack()\"\n        class=\"round-button button\"\n        style=\"float: left\"\n      >\n        <svg\n          xmlns=\"http://www.w3.org/2000/svg\"\n          width=\"24\"\n          height=\"24\"\n          viewBox=\"0 0 24 24\"\n        >\n          <path d=\"M0 0h24v24H0z\" fill=\"none\" />\n          <path\n            d=\"M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z\"\n          />\n        </svg>\n      </div>\n      <button (click)=\"emitClose('cancel')\" style=\"float: right\">\n        {{ cancelLabel }}\n      </button>\n      <button (click)=\"emitClose('accept')\" style=\"float: right\">\n        {{ acceptLabel }}\n      </button>\n    </div>\n    <div class=\"color-picker-wrapper\">\n      <!-- <span [(colorPicker)]=\"color\"></span> -->\n      <color-picker\n        [controls]=\"colorPickerControls\"\n        [color]=\"hsva\"\n        (sliderChange)=\"onChangeColorPicker($event)\"\n      ></color-picker>\n    </div>\n  </ng-container>\n  <div class=\"manual-input-wrapper\" *ngIf=\"!hideTextInput\">\n    <p (click)=\"nextFormat()\">{{ colorFormats[format] }}</p>\n    <div class=\"g-input\">\n      <input\n        placeholder=\"#FFFFFF\"\n        type=\"text\"\n        [value]=\"color\"\n        [style.font-size.px]=\"color && color.length > 23 ? 9 : 10\"\n        [style.letter-spacing.px]=\"color && color.length > 16 ? 0 : 1.5\"\n        (keyup)=\"changeColorManual(paintInput.value)\"\n        (keydown.enter)=\"emitClose('accept')\"\n        #paintInput\n      />\n    </div>\n  </div>\n</div>\n",
                animations: [
                    trigger("colorsAnimation", [
                        transition("void => slide-in", [
                            // Initially all colors are hidden
                            query(":enter", style({ opacity: 0 }), { optional: true }),
                            //slide-in animation
                            query(":enter", stagger("10ms", [
                                animate(".3s ease-in", keyframes([
                                    style({ opacity: 0, transform: "translatex(-50%)", offset: 0 }),
                                    style({
                                        opacity: 0.5,
                                        transform: "translatex(-10px) scale(1.1)",
                                        offset: 0.3,
                                    }),
                                    style({ opacity: 1, transform: "translatex(0)", offset: 1 }),
                                ])),
                            ]), { optional: true }),
                        ]),
                        //popup animation
                        transition("void => popup", [
                            query(":enter", style({ opacity: 0, transform: "scale(0)" }), {
                                optional: true,
                            }),
                            query(":enter", stagger("10ms", [
                                animate("500ms ease-out", keyframes([
                                    style({ opacity: 0.5, transform: "scale(.5)", offset: 0.3 }),
                                    style({ opacity: 1, transform: "scale(1.1)", offset: 0.8 }),
                                    style({ opacity: 1, transform: "scale(1)", offset: 1 }),
                                ])),
                            ]), { optional: true }),
                        ]),
                    ]),
                ],
                styles: [":host{position:fixed;z-index:2001}.hidden{display:none}.button{display:flex;align-items:center;justify-content:center}.top{transform:translateY(-100%)}.opened{box-sizing:border-box;box-shadow:0 2px 4px -1px rgba(0,0,0,.2),0 4px 5px 0 rgba(0,0,0,.14),0 1px 10px 0 rgba(0,0,0,.12);background:#fff;width:250px;border-radius:5px;position:absolute}.opened button{border:none;font-family:inherit;font-size:12px;background-color:unset;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;padding:10px;letter-spacing:1px;color:#222;border-radius:3px;line-height:20px}.opened .button:hover,.opened button:hover{background-color:rgba(0,0,0,.05);transition:opacity .2s cubic-bezier(.35,0,.25,1),background-color .2s cubic-bezier(.35,0,.25,1);transition-property:opacity,background-color;transition-duration:.2s,.2s;transition-timing-function:cubic-bezier(.35,0,.25,1),cubic-bezier(.35,0,.25,1);transition-delay:0s,0s}.opened button:focus{outline:none}.opened .colors{display:flex;flex-wrap:wrap;align-items:center;margin:15px}.opened .colors .circle{height:34px;width:34px;box-sizing:border-box;border-radius:100%;cursor:pointer}.opened .colors .circle .add{font-size:20px;line-height:45px;text-align:center}.opened .colors .circle .selected{border:2px solid #fff;border-radius:100%;height:28px;width:28px;box-sizing:border-box;margin:2px}.opened .colors .circle.wrapper{margin:0 5px 5px;flex:34px 0 0}.opened .colors .circle.button{margin:0 5px 5px}.opened .colors .circle.wrapper.color{background-image:url(\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAABhGlDQ1BJQ0MgcHJvZmlsZQAAKJF9kT1Iw1AUhU/TSkUqDnYQEclQnSyIijhqFYpQIdQKrTqYvPQPmjQkKS6OgmvBwZ/FqoOLs64OroIg+APi5Oik6CIl3pcUWsR44fE+zrvn8N59gNCoMM0KjQOabpvpZELM5lbF8CsCCCGKYQzIzDLmJCkF3/q6p26quzjP8u/7s3rVvMWAgEg8ywzTJt4gnt60Dc77xFFWklXic+Ixky5I/Mh1xeM3zkWXBZ4ZNTPpeeIosVjsYKWDWcnUiKeIY6qmU76Q9VjlvMVZq9RY6578hZG8vrLMdVpDSGIRS5AgQkENZVRgI067ToqFNJ0nfPyDrl8il0KuMhg5FlCFBtn1g//B79lahckJLymSALpeHOdjBAjvAs2643wfO07zBAg+A1d6219tADOfpNfbWuwI6NsGLq7bmrIHXO4AA0+GbMquFKQlFArA+xl9Uw7ovwV61ry5tc5x+gBkaFapG+DgEBgtUva6z7u7O+f2b09rfj8vXnKMvOB8PQAAAAZiS0dEAP8A/wD/oL2nkwAAAAlwSFlzAAALEwAACxMBAJqcGAAAAAd0SU1FB+QBBBQmO5r5LH8AAAArSURBVDjLY/z///9/Bjzg7Nmz+KQZmBgoBKMGDAYDWAjFs7Gx8WggDn8DAOBdCYVQIsgKAAAAAElFTkSuQmCC\")}.opened .colors .circle-border{border:1px solid rgba(0,0,0,.03)}.opened .color-picker-wrapper{margin:5px 15px}.opened .nav-wrapper{overflow:hidden;margin:5px}.opened .nav-wrapper .round-button{padding:5px 0;width:40px;height:40px;box-sizing:border-box;border-radius:100%;text-align:center;line-height:45px}.opened .manual-input-wrapper{display:flex;margin:15px;font-family:sans-serif}.opened .manual-input-wrapper p{margin:0;text-align:center;font-size:10px;letter-spacing:1.5px;text-transform:uppercase;line-height:48px;width:145px;-webkit-touch-callout:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.opened .manual-input-wrapper .g-input{border:1px solid #e8ebed;height:45px;border-radius:5px;width:100%}.opened .manual-input-wrapper .g-input input{font-size:9px;border:none;width:100%;text-transform:uppercase;outline:none;text-align:center;letter-spacing:1px;color:#595b65;height:100%;border-radius:5px;margin:0;padding:0}"]
            },] }
];
PanelComponent.ctorParameters = () => [
    { type: ConverterService },
    { type: ChangeDetectorRef }
];
PanelComponent.propDecorators = {
    click: [{ type: HostListener, args: ["document:click", ["$event"],] }],
    onScroll: [{ type: HostListener, args: ["document:scroll",] }],
    onResize: [{ type: HostListener, args: ["window:resize",] }],
    top: [{ type: HostBinding, args: ["style.top.px",] }],
    left: [{ type: HostBinding, args: ["style.left.px",] }],
    panelRef: [{ type: ViewChild, args: ["dialog",] }]
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicGFuZWwuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vLi4vcHJvamVjdHMvbmd4LWNvbG9ycy9zcmMvbGliL2NvbXBvbmVudHMvcGFuZWwvcGFuZWwuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFDTCxTQUFTLEVBS1QsaUJBQWlCLEVBQ2pCLFNBQVMsRUFFVCxZQUFZLEVBQ1osV0FBVyxHQUNaLE1BQU0sZUFBZSxDQUFDO0FBQ3ZCLE9BQU8sRUFDTCxPQUFPLEVBQ1AsVUFBVSxFQUNWLEtBQUssRUFDTCxLQUFLLEVBQ0wsT0FBTyxFQUNQLE9BQU8sRUFDUCxTQUFTLEdBQ1YsTUFBTSxxQkFBcUIsQ0FBQztBQUU3QixPQUFPLEVBQUUsWUFBWSxFQUFFLE1BQU0scUJBQXFCLENBQUM7QUFDbkQsT0FBTyxFQUFFLGdCQUFnQixFQUFFLE1BQU0sa0NBQWtDLENBQUM7QUFDcEUsT0FBTyxFQUFFLGFBQWEsRUFBRSxNQUFNLDhCQUE4QixDQUFDO0FBQzdELE9BQU8sRUFBRSxPQUFPLEVBQUUsTUFBTSx1QkFBdUIsQ0FBQztBQUVoRCxPQUFPLEVBQUUsSUFBSSxFQUFFLE1BQU0sc0JBQXNCLENBQUM7QUFDNUMsT0FBTyxFQUFFLFFBQVEsRUFBRSxNQUFNLG9CQUFvQixDQUFDO0FBc0Q5QyxNQUFNLE9BQU8sY0FBYztJQW9CekIsWUFDUyxPQUF5QixFQUN4QixHQUFzQjtRQUR2QixZQUFPLEdBQVAsT0FBTyxDQUFrQjtRQUN4QixRQUFHLEdBQUgsR0FBRyxDQUFtQjtRQUd6QixVQUFLLEdBQUcsU0FBUyxDQUFDO1FBQ2xCLGlCQUFZLEdBQVcsU0FBUyxDQUFDO1FBQ2pDLFNBQUksR0FBRyxJQUFJLElBQUksQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQztRQUU1QiwwQkFBcUIsR0FBRyxVQUFVLENBQUM7UUFFbkMsWUFBTyxHQUFH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LENBQUMsRUFBRSxDQUFDO2lDQUN4RCxDQUFDLENBQ0g7NkJBQ0YsQ0FBQyxFQUNGLEVBQUUsUUFBUSxFQUFFLElBQUksRUFBRSxDQUNuQjt5QkFDRixDQUFDO3FCQUNILENBQUM7aUJBQ0g7O2FBQ0Y7OztZQTFEUSxnQkFBZ0I7WUFqQnZCLGlCQUFpQjs7O29CQTZFaEIsWUFBWSxTQUFDLGdCQUFnQixFQUFFLENBQUMsUUFBUSxDQUFDO3VCQU96QyxZQUFZLFNBQUMsaUJBQWlCO3VCQUk5QixZQUFZLFNBQUMsZUFBZTtrQkFLNUIsV0FBVyxTQUFDLGNBQWM7bUJBQzFCLFdBQVcsU0FBQyxlQUFlO3VCQUMzQixTQUFTLFNBQUMsUUFBUSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7XG4gIENvbXBvbmVudCxcbiAgT25Jbml0LFxuICBJbnB1dCxcbiAgT3V0cHV0LFxuICBFdmVudEVtaXR0ZXIsXG4gIENoYW5nZURldGVjdG9yUmVmLFxuICBWaWV3Q2hpbGQsXG4gIEVsZW1lbnRSZWYsXG4gIEhvc3RMaXN0ZW5lcixcbiAgSG9zdEJpbmRpbmcsXG59IGZyb20gXCJAYW5ndWxhci9jb3JlXCI7XG5pbXBvcnQge1xuICB0cmlnZ2VyLFxuICB0cmFuc2l0aW9uLFxuICBxdWVyeSxcbiAgc3R5bGUsXG4gIHN0YWdnZXIsXG4gIGFuaW1hdGUsXG4gIGtleWZyYW1lcyxcbn0gZnJvbSBcIkBhbmd1bGFyL2FuaW1hdGlvbnNcIjtcbmltcG9ydCB7IGlzRGVzY2VuZGFudE9yU2FtZSB9IGZyb20gXCIuLi8uLi9oZWxwZXJzL2hlbHBlcnNcIjtcbmltcG9ydCB7IENvbG9yRm9ybWF0cyB9IGZyb20gXCIuLi8uLi9lbnVtcy9mb3JtYXRzXCI7XG5pbXBvcnQgeyBDb252ZXJ0ZXJTZXJ2aWNlIH0gZnJvbSBcIi4uLy4uL3NlcnZpY2VzL2NvbnZlcnRlci5zZXJ2aWNlXCI7XG5pbXBvcnQgeyBkZWZhdWx0Q29sb3JzIH0gZnJvbSBcIi4uLy4uL2hlbHBlcnMvZGVmYXVsdC1jb2xvcnNcIjtcbmltcG9ydCB7IGZvcm1hdHMgfSBmcm9tIFwiLi4vLi4vaGVscGVycy9mb3JtYXRzXCI7XG5pbXBvcnQgeyBOZ3hDb2xvcnNUcmlnZ2VyRGlyZWN0aXZlIH0gZnJvbSBcIi4uLy4uL2RpcmVjdGl2ZXMvbmd4LWNvbG9ycy10cmlnZ2VyLmRpcmVjdGl2ZVwiO1xuaW1wb3J0IHsgSHN2YSB9IGZyb20gXCIuLi8uLi9jbGFzZXMvZm9ybWF0c1wiO1xuaW1wb3J0IHsgTmd4Q29sb3IgfSBmcm9tIFwiLi4vLi4vY2xhc2VzL2NvbG9yXCI7XG5cbkBDb21wb25lbnQoe1xuICBzZWxlY3RvcjogXCJuZ3gtY29sb3JzLXBhbmVsXCIsXG4gIHRlbXBsYXRlVXJsOiBcIi4vcGFuZWwuY29tcG9uZW50Lmh0bWxcIixcbiAgc3R5bGVVcmxzOiBbXCIuL3BhbmVsLmNvbXBvbmVudC5zY3NzXCJdLFxuICBhbmltYXRpb25zOiBbXG4gICAgdHJpZ2dlcihcImNvbG9yc0FuaW1hdGlvblwiLCBbXG4gICAgICB0cmFuc2l0aW9uKFwidm9pZCA9PiBzbGlkZS1pblwiLCBbXG4gICAgICAgIC8vIEluaXRpYWxseSBhbGwgY29sb3JzIGFyZSBoaWRkZW5cbiAgICAgICAgcXVlcnkoXCI6ZW50ZXJcIiwgc3R5bGUoeyBvcGFjaXR5OiAwIH0pLCB7IG9wdGlvbmFsOiB0cnVlIH0pLFxuICAgICAgICAvL3NsaWRlLWluIGFuaW1hdGlvblxuICAgICAgICBxdWVyeShcbiAgICAgICAgICBcIjplbnRlclwiLFxuICAgICAgICAgIHN0YWdnZXIoXCIxMG1zXCIsIFtcbiAgICAgICAgICAgIGFuaW1hdGUoXG4gICAgICAgICAgICAgIFwiLjNzIGVhc2UtaW5cIixcbiAgICAgICAgICAgICAga2V5ZnJhbWVzKFtcbiAgICAgICAgICAgICAgICBzdHlsZSh7IG9wYWNpdHk6IDAsIHRyYW5zZm9ybTogXCJ0cmFuc2xhdGV4KC01MCUpXCIsIG9mZnNldDogMCB9KSxcbiAgICAgICAgICAgICAgICBzdHlsZSh7XG4gICAgICAgICAgICAgICAgICBvcGFjaXR5OiAwLjUsXG4gICAgICAgICAgICAgICAgICB0cmFuc2Zvcm06IFwidHJhbnNsYXRleCgtMTBweCkgc2NhbGUoMS4xKVwiLFxuICAgICAgICAgICAgICAgICAgb2Zmc2V0OiAwLjMsXG4gICAgICAgICAgICAgICAgfSksXG4gICAgICAgICAgICAgICAgc3R5bGUoeyBvcGFjaXR5OiAxLCB0cmFuc2Zvcm06IFwidHJhbnNsYXRleCgwKVwiLCBvZmZzZXQ6IDEgfSksXG4gICAgICAgICAgICAgIF0pXG4gICAgICAgICAgICApLFxuICAgICAgICAgIF0pLFxuICAgICAgICAgIHsgb3B0aW9uYWw6IHRydWUgfVxuICAgICAgICApLFxuICAgICAgXSksXG4gICAgICAvL3BvcHVwIGFuaW1hdGlvblxuICAgICAgdHJhbnNpdGlvbihcInZvaWQgPT4gcG9wdXBcIiwgW1xuICAgICAgICBxdWVyeShcIjplbnRlclwiLCBzdHlsZSh7IG9wYWNpdHk6IDAsIHRyYW5zZm9ybTogXCJzY2FsZSgwKVwiIH0pLCB7XG4gICAgICAgICAgb3B0aW9uYWw6IHRydWUsXG4gICAgICAgIH0pLFxuICAgICAgICBxdWVyeShcbiAgICAgICAgICBcIjplbnRlclwiLFxuICAgICAgICAgIHN0YWdnZXIoXCIxMG1zXCIsIFtcbiAgICAgICAgICAgIGFuaW1hdGUoXG4gICAgICAgICAgICAgIFwiNTAwbXMgZWFzZS1vdXRcIixcbiAgICAgICAgICAgICAga2V5ZnJhbWVzKFtcbiAgICAgICAgICAgICAgICBzdHlsZSh7IG9wYWNpdHk6IDAuNSwgdHJhbnNmb3JtOiBcInNjYWxlKC41KVwiLCBvZmZzZXQ6IDAuMyB9KSxcbiAgICAgICAgICAgICAgICBzdHlsZSh7IG9wYWNpdHk6IDEsIHRyYW5zZm9ybTogXCJzY2FsZSgxLjEpXCIsIG9mZnNldDogMC44IH0pLFxuICAgICAgICAgICAgICAgIHN0eWxlKHsgb3BhY2l0eTogMSwgdHJhbnNmb3JtOiBcInNjYWxlKDEpXCIsIG9mZnNldDogMSB9KSxcbiAgICAgICAgICAgICAgXSlcbiAgICAgICAgICAgICksXG4gICAgICAgICAgXSksXG4gICAgICAgICAgeyBvcHRpb25hbDogdHJ1ZSB9XG4gICAgICAgICksXG4gICAgICBdKSxcbiAgICBdKSxcbiAgXSxcbn0pXG5leHBvcnQgY2xhc3MgUGFuZWxDb21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQge1xuICBASG9zdExpc3RlbmVyKFwiZG9jdW1lbnQ6Y2xpY2tcIiwgW1wiJGV2ZW50XCJdKVxuICBjbGljayhldmVudCkge1xuICAgIGlmICh0aGlzLmlzT3V0c2lkZShldmVudCkpIHtcbiAgICAgIHRoaXMuZW1pdENsb3NlKFwiY2FuY2VsXCIpO1xuICAgIH1cbiAgfVxuXG4gIEBIb3N0TGlzdGVuZXIoXCJkb2N1bWVudDpzY3JvbGxcIilcbiAgb25TY3JvbGwoKSB7XG4gICAgdGhpcy5vblNjcmVlbk1vdmVtZW50KCk7XG4gIH1cbiAgQEhvc3RMaXN0ZW5lcihcIndpbmRvdzpyZXNpemVcIilcbiAgb25SZXNpemUoKSB7XG4gICAgdGhpcy5vblNjcmVlbk1vdmVtZW50KCk7XG4gIH1cblxuICBASG9zdEJpbmRpbmcoXCJzdHlsZS50b3AucHhcIikgcHVibGljIHRvcDogbnVtYmVyO1xuICBASG9zdEJpbmRpbmcoXCJzdHlsZS5sZWZ0LnB4XCIpIHB1YmxpYyBsZWZ0OiBudW1iZXI7XG4gIEBWaWV3Q2hpbGQoXCJkaWFsb2dcIikgcGFuZWxSZWY6IEVsZW1lbnRSZWY7XG4gIGNvbnN0cnVjdG9yKFxuICAgIHB1YmxpYyBzZXJ2aWNlOiBDb252ZXJ0ZXJTZXJ2aWNlLFxuICAgIHByaXZhdGUgY2RyOiBDaGFuZ2VEZXRlY3RvclJlZlxuICApIHt9XG5cbiAgcHVibGljIGNvbG9yID0gXCIjMDAwMDAwXCI7XG4gIHB1YmxpYyBwcmV2aWV3Q29sb3I6IHN0cmluZyA9IFwiIzAwMDAwMFwiO1xuICBwdWJsaWMgaHN2YSA9IG5ldyBIc3ZhKDAsIDEsIDEsIDEpO1xuXG4gIHB1YmxpYyBjb2xvcnNBbmltYXRpb25FZmZlY3QgPSBcInNsaWRlLWluXCI7XG5cbiAgcHVibGljIHBhbGV0dGUgPSBkZWZhdWx0Q29sb3JzO1xuICBwdWJsaWMgdmFyaWFudHMgPSBbXTtcblxuICBwdWJsaWMgY29sb3JGb3JtYXRzID0gZm9ybWF0cztcbiAgcHVibGljIGZvcm1hdDogQ29sb3JGb3JtYXRzID0gQ29sb3JGb3JtYXRzLkhFWDtcblxuICBwdWJsaWMgY2FuQ2hhbmdlRm9ybWF0OiBib29sZWFuID0gdHJ1ZTtcblxuICBwdWJsaWMgbWVudSA9IDE7XG5cbiAgcHVibGljIGhpZGVDb2xvclBpY2tlcjogYm9vbGVhbiA9IGZhbHNlO1xuICBwdWJsaWMgaGlkZVRleHRJbnB1dDogYm9vbGVhbiA9IGZhbHNlO1xuICBwdWJsaWMgYWNjZXB0TGFiZWw6IHN0cmluZztcbiAgcHVibGljIGNhbmNlbExhYmVsOiBzdHJpbmc7XG4gIHB1YmxpYyBjb2xvclBpY2tlckNvbnRyb2xzOiBcImRlZmF1bHRcIiB8IFwib25seS1hbHBoYVwiIHwgXCJuby1hbHBoYVwiID0gXCJkZWZhdWx0XCI7XG4gIHByaXZhdGUgdHJpZ2dlckluc3RhbmNlOiBOZ3hDb2xvcnNUcmlnZ2VyRGlyZWN0aXZlO1xuICBwcml2YXRlIFRyaWdnZXJCQm94O1xuICBwdWJsaWMgaXNTZWxlY3RlZENvbG9ySW5QYWxldHRlOiBib29sZWFuO1xuICBwdWJsaWMgaW5kZXhTZWxlY2Npb25hZG87XG4gIHB1YmxpYyBwb3NpdGlvblN0cmluZztcbiAgcHVibGljIHRlbXBvcmFsQ29sb3I7XG4gIHB1YmxpYyBiYWNrdXBDb2xvcjtcblxuICBwdWJsaWMgbmdPbkluaXQoKSB7XG4gICAgdGhpcy5zZXRQb3NpdGlvbigpO1xuICAgIHRoaXMuaHN2YSA9IHRoaXMuc2VydmljZS5zdHJpbmdUb0hzdmEodGhpcy5jb2xvcik7XG4gICAgdGhpcy5pbmRleFNlbGVjY2lvbmFkbyA9IHRoaXMuZmluZEluZGV4U2VsZWN0ZWRDb2xvcih0aGlzLnBhbGV0dGUpO1xuICB9XG4gIHB1YmxpYyBuZ0FmdGVyVmlld0luaXQoKSB7XG4gICAgdGhpcy5zZXRQb3NpdGlvblkoKTtcbiAgfVxuXG4gIHByaXZhdGUgb25TY3JlZW5Nb3ZlbWVudCgpIHtcbiAgICB0aGlzLnNldFBvc2l0aW9uKCk7XG4gICAgdGhpcy5zZXRQb3NpdGlvblkoKTtcbiAgICBpZiAoIXRoaXMucGFuZWxSZWYubmF0aXZlRWxlbWVudC5zdHlsZS50cmFuc2l0aW9uKSB7XG4gICAgICB0aGlzLnBhbmVsUmVmLm5hdGl2ZUVsZW1lbnQuc3R5bGUudHJhbnNpdGlvbiA9IFwidHJhbnNmb3JtIDAuNXMgZWFzZS1vdXRcIjtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGZpbmRJbmRleFNlbGVjdGVkQ29sb3IoY29sb3JzKTogbnVtYmVyIHtcbiAgICBsZXQgcmVzdWx0SW5kZXggPSB1bmRlZmluZWQ7XG4gICAgaWYgKHRoaXMuY29sb3IpIHtcbiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgY29sb3JzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgIGNvbnN0IGNvbG9yID0gY29sb3JzW2ldO1xuICAgICAgICBpZiAodHlwZW9mIGNvbG9yID09IFwic3RyaW5nXCIpIHtcbiAgICAgICAgICBpZiAoXG4gICAgICAgICAgICB0aGlzLnNlcnZpY2Uuc3RyaW5nVG9Gb3JtYXQodGhpcy5jb2xvciwgQ29sb3JGb3JtYXRzLkhFWCkgPT1cbiAgICAgICAgICAgIHRoaXMuc2VydmljZS5zdHJpbmdUb0Zvcm1hdChjb2xvciwgQ29sb3JGb3JtYXRzLkhFWClcbiAgICAgICAgICApIHtcbiAgICAgICAgICAgIHJlc3VsdEluZGV4ID0gaTtcbiAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgaWYgKHRoaXMuZmluZEluZGV4U2VsZWN0ZWRDb2xvcihjb2xvci52YXJpYW50cykgIT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICByZXN1bHRJbmRleCA9IGk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiByZXN1bHRJbmRleDtcbiAgfVxuXG4gIHB1YmxpYyBpbmljaWF0ZShcbiAgICB0cmlnZ2VySW5zdGFuY2U6IE5neENvbG9yc1RyaWdnZXJEaXJlY3RpdmUsXG4gICAgdHJpZ2dlckVsZW1lbnRSZWYsXG4gICAgY29sb3IsXG4gICAgcGFsZXR0ZSxcbiAgICBhbmltYXRpb24sXG4gICAgZm9ybWF0OiBzdHJpbmcsXG4gICAgaGlkZVRleHRJbnB1dDogYm9vbGVhbixcbiAgICBoaWRlQ29sb3JQaWNrZXI6IGJvb2xlYW4sXG4gICAgYWNjZXB0TGFiZWw6IHN0cmluZyxcbiAgICBjYW5jZWxMYWJlbDogc3RyaW5nLFxuICAgIGNvbG9yUGlja2VyQ29udHJvbHM6IFwiZGVmYXVsdFwiIHwgXCJvbmx5LWFscGhhXCIgfCBcIm5vLWFscGhhXCIsXG4gICAgcG9zaXRpb246IFwidG9wXCIgfCBcImJvdHRvbVwiXG4gICkge1xuICAgIHRoaXMuY29sb3JQaWNrZXJDb250cm9scyA9IGNvbG9yUGlja2VyQ29udHJvbHM7XG4gICAgdGhpcy50cmlnZ2VySW5zdGFuY2UgPSB0cmlnZ2VySW5zdGFuY2U7XG4gICAgdGhpcy5UcmlnZ2VyQkJveCA9IHRyaWdnZXJFbGVtZW50UmVmO1xuICAgIHRoaXMuY29sb3IgPSBjb2xvcjtcbiAgICB0aGlzLmhpZGVDb2xvclBpY2tlciA9IGhpZGVDb2xvclBpY2tlcjtcbiAgICB0aGlzLmhpZGVUZXh0SW5wdXQgPSBoaWRlVGV4dElucHV0O1xuICAgIHRoaXMuYWNjZXB0TGFiZWwgPSBhY2NlcHRMYWJlbDtcbiAgICB0aGlzLmNhbmNlbExhYmVsID0gY2FuY2VsTGFiZWw7XG4gICAgaWYgKGZvcm1hdCkge1xuICAgICAgaWYgKGZvcm1hdHMuaW5jbHVkZXMoZm9ybWF0KSkge1xuICAgICAgICB0aGlzLmZvcm1hdCA9IGZvcm1hdHMuaW5kZXhPZihmb3JtYXQudG9Mb3dlckNhc2UoKSk7XG4gICAgICAgIHRoaXMuY2FuQ2hhbmdlRm9ybWF0ID0gZmFsc2U7XG4gICAgICAgIGlmIChcbiAgICAgICAgICB0aGlzLnNlcnZpY2UuZ2V0Rm9ybWF0QnlTdHJpbmcodGhpcy5jb2xvcikgIT0gZm9ybWF0LnRvTG93ZXJDYXNlKClcbiAgICAgICAgKSB7XG4gICAgICAgICAgdGhpcy5zZXRDb2xvcih0aGlzLnNlcnZpY2Uuc3RyaW5nVG9Ic3ZhKHRoaXMuY29sb3IpKTtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcIkZvcm1hdCBwcm92aWRlZCBpcyBpbnZhbGlkLCB1c2luZyBIRVhcIik7XG4gICAgICAgIHRoaXMuZm9ybWF0ID0gQ29sb3JGb3JtYXRzLkhFWDtcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5mb3JtYXQgPSBmb3JtYXRzLmluZGV4T2YodGhpcy5zZXJ2aWNlLmdldEZvcm1hdEJ5U3RyaW5nKHRoaXMuY29sb3IpKTtcbiAgICB9XG5cbiAgICB0aGlzLnByZXZpZXdDb2xvciA9IHRoaXMuY29sb3I7XG4gICAgdGhpcy5wYWxldHRlID0gcGFsZXR0ZSA/PyBkZWZhdWx0Q29sb3JzO1xuICAgIHRoaXMuY29sb3JzQW5pbWF0aW9uRWZmZWN0ID0gYW5pbWF0aW9uO1xuICAgIGlmIChwb3NpdGlvbiA9PSBcInRvcFwiKSB7XG4gICAgICBsZXQgVHJpZ2dlckJCb3ggPSB0aGlzLlRyaWdnZXJCQm94Lm5hdGl2ZUVsZW1lbnQuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7XG4gICAgICB0aGlzLnBvc2l0aW9uU3RyaW5nID1cbiAgICAgICAgXCJ0cmFuc2Zvcm06IHRyYW5zbGF0ZVkoY2FsYyggLTEwMCUgLSBcIiArIFRyaWdnZXJCQm94LmhlaWdodCArIFwicHggKSlcIjtcbiAgICB9XG4gIH1cblxuICBwdWJsaWMgc2V0UG9zaXRpb24oKSB7XG4gICAgaWYgKHRoaXMuVHJpZ2dlckJCb3gpIHtcbiAgICAgIHZhciB2aWV3cG9ydE9mZnNldCA9XG4gICAgICAgIHRoaXMuVHJpZ2dlckJCb3gubmF0aXZlRWxlbWVudC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcbiAgICAgIHRoaXMudG9wID0gdmlld3BvcnRPZmZzZXQudG9wICsgdmlld3BvcnRPZmZzZXQuaGVpZ2h0O1xuICAgICAgdGhpcy5sZWZ0ID1cbiAgICAgICAgdmlld3BvcnRPZmZzZXQubGVmdCArIDI1MCA+IHdpbmRvdy5pbm5lcldpZHRoXG4gICAgICAgICAgPyB2aWV3cG9ydE9mZnNldC5yaWdodCAtIDI1MFxuICAgICAgICAgIDogdmlld3BvcnRPZmZzZXQubGVmdDtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIHNldFBvc2l0aW9uWSgpIHtcbiAgICB2YXIgdHJpZ2dlckJCb3ggPSB0aGlzLlRyaWdnZXJCQm94Lm5hdGl2ZUVsZW1lbnQuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7XG4gICAgdmFyIHBhbmVsQkJveCA9IHRoaXMucGFuZWxSZWYubmF0aXZlRWxlbWVudC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcbiAgICB2YXIgcGFuZWxIZWlnaHQgPSBwYW5lbEJCb3guaGVpZ2h0O1xuXG4gICAgLy9DaGVjayBmb3Igc3BhY2UgYWJvdmUgdGhlIHRyaWdnZXJcbiAgICBpZiAoMCA+IHBhbmVsQkJveC50b3AgLSA1KSB7XG4gICAgICB0aGlzLnBvc2l0aW9uU3RyaW5nID0gXCJcIjtcbiAgICB9XG4gICAgLy9DaGVjayBmb3Igc3BhY2UgYmVsb3cgdGhlIHRyaWdnZXJcbiAgICBpZiAocGFuZWxIZWlnaHQgPiB3aW5kb3cuaW5uZXJIZWlnaHQgLSAocGFuZWxCQm94LnRvcCAtIDUpKSB7XG4gICAgICAvL3RoZXJlIGlzIG5vIHNwYWNlLCBtb3ZlIHBhbmVsIG92ZXIgdGhlIHRyaWdnZXJcbiAgICAgIHRoaXMucG9zaXRpb25TdHJpbmcgPVxuICAgICAgICBcInRyYW5zZm9ybTogdHJhbnNsYXRlWShjYWxjKCAtMTAwJSAtIFwiICsgdHJpZ2dlckJCb3guaGVpZ2h0ICsgXCJweCApKTtcIjtcbiAgICB9XG4gICAgdGhpcy5jZHIuZGV0ZWN0Q2hhbmdlcygpO1xuICB9XG5cbiAgcHVibGljIGhhc1ZhcmlhbnQoY29sb3IpOiBib29sZWFuIHtcbiAgICBpZiAoIXRoaXMucHJldmlld0NvbG9yKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIHJldHVybiAoXG4gICAgICB0eXBlb2YgY29sb3IgIT0gXCJzdHJpbmdcIiAmJlxuICAgICAgY29sb3IudmFyaWFudHMuc29tZShcbiAgICAgICAgKHYpID0+IHYudG9VcHBlckNhc2UoKSA9PSB0aGlzLnByZXZpZXdDb2xvci50b1VwcGVyQ2FzZSgpXG4gICAgICApXG4gICAgKTtcbiAgfVxuXG4gIHB1YmxpYyBpc1NlbGVjdGVkKGNvbG9yKSB7XG4gICAgaWYgKCF0aGlzLnByZXZpZXdDb2xvcikge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICByZXR1cm4gKFxuICAgICAgdHlwZW9mIGNvbG9yID09IFwic3RyaW5nXCIgJiZcbiAgICAgIGNvbG9yLnRvVXBwZXJDYXNlKCkgPT0gdGhpcy5wcmV2aWV3Q29sb3IudG9VcHBlckNhc2UoKVxuICAgICk7XG4gIH1cblxuICBwdWJsaWMgZ2V0QmFja2dyb3VuZENvbG9yKGNvbG9yKSB7XG4gICAgaWYgKHR5cGVvZiBjb2xvciA9PSBcInN0cmluZ1wiKSB7XG4gICAgICByZXR1cm4geyBiYWNrZ3JvdW5kOiBjb2xvciB9O1xuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4geyBiYWNrZ3JvdW5kOiBjb2xvcj8ucHJldmlldyB9O1xuICAgIH1cbiAgfVxuXG4gIHB1YmxpYyBvbkFscGhhQ2hhbmdlKGV2ZW50KSB7XG4gICAgdGhpcy5wYWxldHRlID0gdGhpcy5DaGFuZ2VBbHBoYU9uUGFsZXR0ZShldmVudCwgdGhpcy5wYWxldHRlKTtcbiAgfVxuXG4gIHByaXZhdGUgQ2hhbmdlQWxwaGFPblBhbGV0dGUoXG4gICAgYWxwaGEsXG4gICAgY29sb3JzOiBBcnJheTxzdHJpbmcgfCBOZ3hDb2xvcj5cbiAgKTogQXJyYXk8YW55PiB7XG4gICAgdmFyIHJlc3VsdCA9IFtdO1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgY29sb3JzLmxlbmd0aDsgaSsrKSB7XG4gICAgICBjb25zdCBjb2xvciA9IGNvbG9yc1tpXTtcbiAgICAgIGlmICh0eXBlb2YgY29sb3IgPT0gXCJzdHJpbmdcIikge1xuICAgICAgICBsZXQgbmV3Q29sb3IgPSB0aGlzLnNlcnZpY2Uuc3RyaW5nVG9Ic3ZhKGNvbG9yKTtcbiAgICAgICAgbmV3Q29sb3Iub25BbHBoYUNoYW5nZShhbHBoYSk7XG4gICAgICAgIHJlc3VsdC5wdXNoKHRoaXMuc2VydmljZS50b0Zvcm1hdChuZXdDb2xvciwgdGhpcy5mb3JtYXQpKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGxldCBuZXdDb2xvciA9IG5ldyBOZ3hDb2xvcigpO1xuICAgICAgICBsZXQgbmV3Q29sb3JQcmV2aWV3ID0gdGhpcy5zZXJ2aWNlLnN0cmluZ1RvSHN2YShjb2xvci5wcmV2aWV3KTtcbiAgICAgICAgbmV3Q29sb3JQcmV2aWV3Lm9uQWxwaGFDaGFuZ2UoYWxwaGEpO1xuICAgICAgICBuZXdDb2xvci5wcmV2aWV3ID0gdGhpcy5zZXJ2aWNlLnRvRm9ybWF0KG5ld0NvbG9yUHJldmlldywgdGhpcy5mb3JtYXQpO1xuICAgICAgICBuZXdDb2xvci52YXJpYW50cyA9IHRoaXMuQ2hhbmdlQWxwaGFPblBhbGV0dGUoYWxwaGEsIGNvbG9yLnZhcmlhbnRzKTtcbiAgICAgICAgcmVzdWx0LnB1c2gobmV3Q29sb3IpO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gcmVzdWx0O1xuICB9XG5cbiAgLyoqXG4gICAqIENoYW5nZSBjb2xvciBmcm9tIGRlZmF1bHQgY29sb3JzXG4gICAqIEBwYXJhbSBzdHJpbmcgY29sb3JcbiAgICovXG4gIHB1YmxpYyBjaGFuZ2VDb2xvcihjb2xvcjogc3RyaW5nKTogdm9pZCB7XG4gICAgdGhpcy5zZXRDb2xvcih0aGlzLnNlcnZpY2Uuc3RyaW5nVG9Ic3ZhKGNvbG9yKSk7XG4gICAgLy8gdGhpcy50cmlnZ2VySW5zdGFuY2Uub25DaGFuZ2UoKTtcbiAgICB0aGlzLmVtaXRDbG9zZShcImFjY2VwdFwiKTtcbiAgfVxuXG4gIHB1YmxpYyBvbkNoYW5nZUNvbG9yUGlja2VyKGV2ZW50OiBIc3ZhKSB7XG4gICAgdGhpcy50ZW1wb3JhbENvbG9yID0gZXZlbnQ7XG4gICAgdGhpcy5jb2xvciA9IHRoaXMuc2VydmljZS50b0Zvcm1hdChldmVudCwgdGhpcy5mb3JtYXQpO1xuICAgIC8vIHRoaXMuc2V0Q29sb3IoZXZlbnQpO1xuICAgIHRoaXMudHJpZ2dlckluc3RhbmNlLnNsaWRlckNoYW5nZShcbiAgICAgIHRoaXMuc2VydmljZS50b0Zvcm1hdChldmVudCwgdGhpcy5mb3JtYXQpXG4gICAgKTtcbiAgfVxuXG4gIHB1YmxpYyBjaGFuZ2VDb2xvck1hbnVhbChjb2xvcjogc3RyaW5nKTogdm9pZCB7XG4gICAgdGhpcy5wcmV2aWV3Q29sb3IgPSBjb2xvcjtcbiAgICB0aGlzLmNvbG9yID0gY29sb3I7XG4gICAgdGhpcy5oc3ZhID0gdGhpcy5zZXJ2aWNlLnN0cmluZ1RvSHN2YShjb2xvcik7XG4gICAgdGhpcy50cmlnZ2VySW5zdGFuY2Uuc2V0Q29sb3IodGhpcy5jb2xvcik7XG4gICAgLy8gdGhpcy50cmlnZ2VySW5zdGFuY2Uub25DaGFuZ2UoKTtcbiAgfVxuXG4gIHNldENvbG9yKHZhbHVlOiBIc3ZhKSB7XG4gICAgdGhpcy5oc3ZhID0gdmFsdWU7XG4gICAgdGhpcy5jb2xvciA9IHRoaXMuc2VydmljZS50b0Zvcm1hdCh2YWx1ZSwgdGhpcy5mb3JtYXQpO1xuICAgIHRoaXMuc2V0UHJldmlld0NvbG9yKHZhbHVlKTtcbiAgICB0aGlzLnRyaWdnZXJJbnN0YW5jZS5zZXRDb2xvcih0aGlzLmNvbG9yKTtcbiAgfVxuXG4gIHNldFByZXZpZXdDb2xvcih2YWx1ZTogSHN2YSkge1xuICAgIHRoaXMucHJldmlld0NvbG9yID0gdGhpcy5zZXJ2aWNlLmhzdmFUb1JnYmEodmFsdWUpLnRvU3RyaW5nKCk7XG4gIH1cbiAgaHN2YVRvUmdiYTtcbiAgb25DaGFuZ2UoKSB7XG4gICAgLy8gdGhpcy50cmlnZ2VySW5zdGFuY2Uub25DaGFuZ2UoKTtcbiAgfVxuXG4gIHB1YmxpYyBvbkNvbG9yQ2xpY2soY29sb3IpIHtcbiAgICBpZiAodHlwZW9mIGNvbG9yID09IFwic3RyaW5nXCIpIHtcbiAgICAgIHRoaXMuY2hhbmdlQ29sb3IoY29sb3IpO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLnZhcmlhbnRzID0gY29sb3IudmFyaWFudHM7XG4gICAgICB0aGlzLm1lbnUgPSAyO1xuICAgIH1cbiAgfVxuXG4gIHB1YmxpYyBhZGRDb2xvcigpIHtcbiAgICB0aGlzLm1lbnUgPSAzO1xuICAgIHRoaXMuYmFja3VwQ29sb3IgPSB0aGlzLmNvbG9yO1xuICAgIHRoaXMuY29sb3IgPSBcIiNGRjAwMDBcIjtcbiAgICB0aGlzLnRlbXBvcmFsQ29sb3IgPSB0aGlzLnNlcnZpY2Uuc3RyaW5nVG9Ic3ZhKHRoaXMuY29sb3IpO1xuICB9XG5cbiAgcHVibGljIG5leHRGb3JtYXQoKSB7XG4gICAgaWYgKHRoaXMuY2FuQ2hhbmdlRm9ybWF0KSB7XG4gICAgICB0aGlzLmZvcm1hdCA9ICh0aGlzLmZvcm1hdCArIDEpICUgdGhpcy5jb2xvckZvcm1hdHMubGVuZ3RoO1xuICAgICAgdGhpcy5zZXRDb2xvcih0aGlzLmhzdmEpO1xuICAgIH1cbiAgfVxuXG4gIHB1YmxpYyBlbWl0Q2xvc2Uoc3RhdHVzOiBcImNhbmNlbFwiIHwgXCJhY2NlcHRcIikge1xuICAgIGlmICh0aGlzLm1lbnUgPT0gMykge1xuICAgICAgaWYgKHN0YXR1cyA9PSBcImNhbmNlbFwiKSB7XG4gICAgICB9IGVsc2UgaWYgKHN0YXR1cyA9PSBcImFjY2VwdFwiKSB7XG4gICAgICAgIHRoaXMuc2V0Q29sb3IodGhpcy50ZW1wb3JhbENvbG9yKTtcbiAgICAgIH1cbiAgICB9XG4gICAgdGhpcy50cmlnZ2VySW5zdGFuY2UuY2xvc2UoKTtcbiAgfVxuXG4gIHB1YmxpYyBvbkNsaWNrQmFjaygpIHtcbiAgICBpZiAodGhpcy5tZW51ID09IDMpIHtcbiAgICAgIHRoaXMuY29sb3IgPSB0aGlzLmJhY2t1cENvbG9yO1xuICAgICAgdGhpcy5oc3ZhID0gdGhpcy5zZXJ2aWNlLnN0cmluZ1RvSHN2YSh0aGlzLmNvbG9yKTtcbiAgICB9XG4gICAgdGhpcy5pbmRleFNlbGVjY2lvbmFkbyA9IHRoaXMuZmluZEluZGV4U2VsZWN0ZWRDb2xvcih0aGlzLnBhbGV0dGUpO1xuICAgIHRoaXMubWVudSA9IDE7XG4gIH1cblxuICBpc091dHNpZGUoZXZlbnQpIHtcbiAgICByZXR1cm4gZXZlbnQudGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucyhcIm5neC1jb2xvcnMtb3ZlcmxheVwiKTtcbiAgfVxufVxuIl19